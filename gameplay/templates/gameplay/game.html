<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hra {{ game.id }}</title>
    <style>
        body {
    display: grid;
    place-items: center;  /* Centering to middle */
    height: 100vh;  /* Will take entire screen from bottom */
    margin: 0;  /* remove spaces */
}
        .sudoku-grid {
            display: grid;
            place-items: center;
            grid-template-columns: repeat(9, 80px);
            grid-template-rows: repeat(9, 80px);
            gap: 2px;
        }
        .cell {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid black;
            font-size: 18px;
            cursor: pointer;
        }
        .grid-border {
            border-right: 3px solid black;
            border-bottom: 3px solid black;
        }
        .selected {
            background-color: lightblue;
        }
    </style>
<script>
    let selectedItem = null;

    function selectItem(itemId) {
        selectedItem = itemId;
        document.querySelectorAll('.item-btn').forEach(btn => btn.classList.remove('selected'));
        document.getElementById('item-' + itemId).classList.add('selected');
    }

    function placeItem(cellId, currentItemId) {
        let itemToSend = selectedItem !== null ? selectedItem : -1;  // Nikdy neposílat null

        if (currentItemId === selectedItem) {
            itemToSend = -1;
        }

        console.log(`Sending request: /gameplay/place/${cellId}/ s daty { item_id: ${itemToSend} }`);

        fetch(`/gameplay/place/${cellId}/`, {
            method: "POST",
            headers: {
                "X-CSRFToken": "{{ csrf_token }}",
                "Content-Type": "application/json",
            },
            body: JSON.stringify({ item_id: itemToSend })  // Sending item_id jako JSON
        })
        .then(response => response.json())
        .then(data => {
            console.log("Server response:", data); // Debug
            if (data.status === "completed") {
                window.location.href = "/gameplay/win/";
            } else {
                location.reload();
            }
        })
        .catch(error => console.error("Error communicating whit server:", error));
    }
</script>
</head>
<body>
    <h1>Hra č. {{ game.id }}</h1>
    <p>Hráč: {{ game.player.username }}</p>

    <h2>Vyber předmět</h2>
        <div>
            {% for item in items %}
                <button id="item-{{ item.id }}" class="item-btn" onclick="selectItem({{ item.id }})">
                    {{ item.number }} - {{ item.name }}
                </button>
            {% endfor %}
        </div>
<style>
    .correct {
        background-color: lightgreen;
    }
    .incorrect {
        background-color: lightcoral;
    }
</style>
    <h2>Herní mřížka</h2>
       <div class="sudoku-grid">
    {% for cell in cells %}
        <div class="cell
            {% if cell.column in grid_borders %} grid-border{% endif %}
            {% if cell.row in grid_borders %} grid-border{% endif %}
            {% if cell.selected_item and cell.is_correct %} correct{% endif %}
            {% if cell.selected_item and not cell.is_correct %} incorrect{% endif %}"
            onclick="placeItem({{ cell.id }}, {% if cell.selected_item %}{{ cell.selected_item.id }}{% else %}-1{% endif %})">
            {% if cell.selected_item %}
                {{ cell.selected_item.number }} - {{ cell.selected_item.name }}
            {% endif %}
        </div>
    {% endfor %}
</div>

    <a href="{% url 'start_new_game' %}">Spustit novou hru</a>
</body>
</html>